#!/bin/bash

##########################################
## Backend Application Server Core Apps ##
##########################################

# Capture Verbose Output

set -o errexit
set -o nounset
set -o pipefail

# Install Core Apps

echo "==== installing core apps for application server ===="

for var in java maven git ;
do
sudo yum update -y ; sudo yum install java-1.8.0-openjdk-devel maven git -y $var
done

# Test Install Success

echo " ======= testing if core apps succesfully installed ======== "

sleep 5s

maven_version=$(mvn --version | grep Apache | awk '/Maven/ {print$2, $3}')

echo "Maven version is $maven_version"

if [ "$maven_version" = "Maven 3.0.5" ]
then
echo "Core tools installation successfull"
else
echo "Core tools installation unsuccessful"
fi

sleep 5s

# Test to ensure Java is listening on port 8080

Port=$(netstat -tuln | grep 8080 | head -n -1 | awk '{print$1, $4, $6}')

echo " =============== testing if port is listening =============== "

sleep 5s

if [ "$Port" = "tcp 0.0.0.0:8080 LISTEN" ]
then
   echo "Port is listening"
else
   echo "Port is not listening, resolve"
fi

sleep 5s

curl -X GET "localhost:8080" 